<!DOCTYPE html>
<html class="w-full h-full">

<head>
  <title>Kalosm 0.2 - Floneum Blog</title>
  <meta name="description" content="Floneum is a graph editor for local LLM workflows." />
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="UTF-8" />
  <style>
    .markdown-body ul {
      list-style: disc;
    }

    .markdown-body ol {
      list-style: decimal;
    }

    .markdown-body li {
      display: list-item;
    }

    .markdown-body button {
      display: inline-block;
      background-color: rgba(209, 213, 219, 0.3);
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      border: 1px solid;
      margin: 0.25rem;
    }

    .markdown-body .header {
      color: inherit
    }

    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 5%;
      /* padding: 45px; */
      list-style: disc;
    }

    .main::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .main {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }
  </style>
  <script src="https://buttons.github.io/buttons.js"></script>
<link rel="preload" as="script" href="/./assets/floneum-site-fa30d29a333f8ebd.js" crossorigin><link rel="preload" as="fetch" type="application/wasm" href="/./assets/floneum-site_bg-345df61ed7f53097.wasm" crossorigin><link rel="stylesheet" href="/assets/output-956cf6bd1a90dc22.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-light.min.css"/><link rel="icon" href="/assets/Icon-7abfef476d4b581a.png" type="image/png"/></head>

<body style="overflow-x:hidden;--scroll:0;" class="w-full h-full">
  <div id="main" class="w-full h-full"><script>window.hydrate_queue=[];window.dx_hydrate=(id,data,debug_types,debug_locations)=>{const decoded=atob(data),bytes=Uint8Array.from(decoded,(c)=>c.charCodeAt(0));if(window.hydration_callback)window.hydration_callback(id,bytes,debug_types,debug_locations);else window.hydrate_queue.push([id,bytes,debug_types,debug_locations])};
</script><!--placeholder0--><!--placeholder1--><!--placeholder2--><!--placeholder3--><nav class="bg-white shadow" data-node-hydration="4"><div class="mx-auto max-w-7xl px-2 sm:px-4 lg:px-8"><div class="flex h-16 justify-between"><div class="flex px-2 lg:px-0"><div class="flex flex-shrink-0 items-center"><a href="/" class="text-xl m-2 md:mr-12 flex flex-row items-center" data-node-hydration="5,click:1"><img src="/assets/Icon-7abfef476d4b581a.png" class="h-8 w-8 mx-2" alt="Floneum" data-node-hydration="6"/><!--node-id7-->Floneum<!--#--></a></div><div class="hidden lg:ml-6 lg:flex lg:space-x-8"><a href="/" class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700" data-node-hydration="8,click:1"><!--node-id9-->Home<!--#--></a><a href="/docs/#" class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700" data-node-hydration="10,click:1"><!--node-id11-->Docs<!--#--></a></div></div><div class="flex flex-1 items-center justify-center px-2 lg:ml-6 lg:justify-end"><div class="w-full max-w-lg lg:max-w-xs"><label for="search" class="sr-only" data-node-hydration="12">Search</label><div class="relative" data-node-hydration="13"><div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="h-5 w-5 text-gray-400"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"></path></svg></div><button name="search" class="block w-full rounded-md border-0 bg-white py-1.5 pl-10 pr-3 text-gray-400 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" id="search" data-node-hydration="14,click:1"><div class="h-full my-auto flex flex-row align-middle justify-between"><span class="md:pl-2">Search</span><div class="ml-3 flex-none font-semibold text-gray-500"><kbd class="font-sans">CTRL + /</kbd></div></div></button></div></div></div><div class="flex items-center lg:hidden"><button aria-expanded="false" type="button" aria-controls="mobile-menu" class="relative inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" data-node-hydration="15,click:1"><span class="absolute -inset-0.5"></span><span class="sr-only">Open main menu</span><svg stroke="currentColor" fill="none" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true" class="block h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" aria-hidden="true" fill="none" class="hidden h-6 w-6"><path stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" stroke-linecap="round"></path></svg></button></div></div></div><div class="lg:hidden hidden" id="mobile-menu" data-node-hydration="16"><div class="space-y-1 pb-3 pt-2"><a href="/" class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium text-gray-600 hover:border-gray-300 hover:bg-gray-50 hover:text-gray-800" role="menuitem" tabindex="-1" data-node-hydration="17,click:1"><!--node-id18-->Home<!--#--></a><a href="/docs/#" class="block border-l-4 border-transparent py-2 pl-3 pr-4 text-base font-medium text-gray-600 hover:border-gray-300 hover:bg-gray-50 hover:text-gray-800" role="menuitem" tabindex="-1" data-node-hydration="19,click:1"><!--node-id20-->Docs<!--#--></a></div></div></nav><div class="w-full pt-12 backdrop-blur-lg bg-white/75" style="min-height:100vh;" data-node-hydration="21"><div class="max-w-screen-2xl flex flex-row justify-between mx-auto"><!--placeholder22--><section class="body-font overflow-hidden mx-auto container pt-12 pb-12 md:w-2/3" data-node-hydration="23"><div class="-my-8"><div class="w-full mb-20 flex-wrap list-none rounded-md"><article class="markdown-body pt-1"><h1 id="kalosm-v020-tasks-evaluation-prompt-auto-tuning-regex-validation-surreal-database-integration-rag-improvements-performance-improvements-and-more" data-node-hydration="24"><a href="/blog/kalosm_0_2#kalosm-v020-tasks-evaluation-prompt-auto-tuning-regex-validation-surreal-database-integration-rag-improvements-performance-improvements-and-more" class="header" data-node-hydration="25,click:1"><!--node-id26-->Kalosm v0.2.0 Tasks, Evaluation, Prompt Auto-Tuning, Regex Validation, Surreal Database Integration, RAG improvements, Performance Improvements, and More!<!--#--></a></h1><p data-node-hydration="27">We&#x27;re excited to announce the release of Kalosm v0.2.0! This release includes a number of new features, improvements, and bug fixes including:</p><ul data-node-hydration="28"><li>Tasks and Agents</li><li>Task Evaluation</li><li>Prompt Auto-Tuning</li><li>Regex Validation</li><li>Surreal Database Integration</li><li>RAG improvements</li><li>Performance Improvements</li><li>New Models</li></ul><h2 id="tasks-and-agents" data-node-hydration="29"><a href="/blog/kalosm_0_2#tasks-and-agents" class="header" data-node-hydration="30,click:1"><!--node-id31-->Tasks and Agents!<!--#--></a></h2><p data-node-hydration="32">Kalosm now includes utilities for running, evaluating, and improving tasks and agents.</p><p data-node-hydration="33">Let&#x27;s build a simple task and agent to demonstrate the new functionality.</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="34"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="35,click:1"><!--placeholder36--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="37"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="38"><pre style="background-color:#0d0d0d;">
<span style="color:#f92672;">use </span><span style="color:#f8f8f2;">kalosm::language::</span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">#[tokio::main]
</span><span style="color:#f8f8f2;">async </span><span style="font-style:italic;color:#66d9ef;">fn </span><span style="color:#a6e22e;">main</span><span style="color:#f8f8f2;">() {
</span><span style="color:#f8f8f2;">	</span><span style="color:#8c8c8c;">// You can use tasks with llama, mistral or phi models.
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> llm </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Phi::new_chat();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Now we can create a task. We will create a simple assistant that identifies keywords in a sentence.
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> task </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Task::builder(</span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">llm, </span><span style="color:#ffee99;">&quot;You are an assistant who identifies keywords in a sentence. When identifying keywords, you will output the keywords in a comma-separated list.&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">		</span><span style="color:#8c8c8c;">// You can optionally add constraints to the task.
</span><span style="color:#f8f8f2;">        </span><span style="color:#8c8c8c;">// accept 2-5 keywords of 2-15 characters each
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">with_constraints</span><span style="color:#f8f8f2;">(RegexParser::new(</span><span style="font-style:italic;color:#66d9ef;">r</span><span style="color:#ffee99;">#&quot;The keywords are:([ a-z]{2,15},){2,5}&quot;#</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">())
</span><span style="color:#f8f8f2;">		</span><span style="color:#8c8c8c;">/// You can also add examples to the task to help the agent learn how to solve math problems.
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">with_example</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is the weather like in New York?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;The keywords are: weather, new york, &quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">with_example</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is the capital of France?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;The keywords are: capital, france, &quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">build</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// The first time we use the task, it will load the model and prompt which will take a bit longer.
</span><span style="color:#f8f8f2;">    task.</span><span style="color:#66d9ef;">run</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is the temperature in Chicago?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">llm)
</span><span style="color:#f8f8f2;">        .await
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">to_std_out</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">        .await
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">}</span></pre>
</div></div><p data-node-hydration="39">Or you can use more complex constraints to </p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="40"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="41,click:1"><!--placeholder42--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="43"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="44"><pre style="background-color:#0d0d0d;">
<span style="color:#8c8c8c;">// First, we need to create a Llama instance. We will use the default chat model (open chat) for this example. Tasks work with chat and text generation models.
</span><span style="font-style:italic;color:#66d9ef;">let </span><span style="color:#f92672;">mut</span><span style="color:#f8f8f2;"> llm </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Llama::new_chat();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// Next (optionally), we can define constraints for the task. In this example, we will use a regex to validate the output of the task.
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> constraints </span><span style="color:#f92672;">=
</span><span style="color:#f8f8f2;">	RegexParser::new(</span><span style="font-style:italic;color:#66d9ef;">r</span><span style="color:#ffee99;">&quot;(Step \d: \d+ [+\-*/] \d+ = \d+\n){1,3}Output: \d+&quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// Now we can create a task. We will create a simple math problem solving task.
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> task </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Task::builder(</span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">llm, </span><span style="color:#ffee99;">&quot;You are an assistant who solves math problems. When solving problems, you will always solve problems step by step with one step per line. Once you have solved the problem, you will output the result in the format &#39;Output: &lt;result&gt;&#39;.&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">with_constraints</span><span style="color:#f8f8f2;">(constraints)
</span><span style="color:#f8f8f2;">	</span><span style="color:#8c8c8c;">// You can also add examples to the task to help the agent learn how to solve math problems.
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">with_example</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is 1 + 2?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Step 1: 1 + 2 = 3</span><span style="color:#ff80f4;">\n</span><span style="color:#ffee99;">Output: 3&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">with_example</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is 3 + 4?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Step 1: 3 + 4 = 7</span><span style="color:#ff80f4;">\n</span><span style="color:#ffee99;">Output: 7&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">with_example</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is (4 + 8) / 3?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Step 1: 4 + 8 = 12</span><span style="color:#ff80f4;">\n</span><span style="color:#ffee99;">Step 2: 12 / 3 = 4</span><span style="color:#ff80f4;">\n</span><span style="color:#ffee99;">Output: 4&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">build</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// The first time we use the task, it will load the model and prompt which will take a bit longer.
</span><span style="color:#f8f8f2;">task.</span><span style="color:#66d9ef;">run</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;What is 2 + 2?&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">llm)
</span><span style="color:#f8f8f2;">	.await
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">to_std_out</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">	.await
</span><span style="color:#f8f8f2;">	.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();</span></pre>
</div></div><p data-node-hydration="45">Tasks can efficiently reuse the session between runs, which can significantly speed up the process:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="46"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="47,click:1"><!--placeholder48--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="49"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="50"><pre style="background-color:#0d0d0d;">
<span style="color:#f8f8f2;">question </span><span style="color:#ff80f4;">1
</span><span style="color:#f8f8f2;">Step </span><span style="color:#ff80f4;">1</span><span style="color:#f8f8f2;">: </span><span style="color:#ff80f4;">2 </span><span style="color:#f92672;">+ </span><span style="color:#ff80f4;">2 </span><span style="color:#f92672;">= </span><span style="color:#ff80f4;">4
</span><span style="color:#f8f8f2;">Output: </span><span style="color:#ff80f4;">4.
</span><span style="color:#f8f8f2;">first question took: </span><span style="color:#ff80f4;">18.371939709</span><span style="color:#f8f8f2;">s
</span><span style="color:#f8f8f2;">question </span><span style="color:#ff80f4;">2
</span><span style="color:#f8f8f2;">Step </span><span style="color:#ff80f4;">1</span><span style="color:#f8f8f2;">: </span><span style="color:#ff80f4;">4 </span><span style="color:#f92672;">+ </span><span style="color:#ff80f4;">4 </span><span style="color:#f92672;">= </span><span style="color:#ff80f4;">8
</span><span style="color:#f8f8f2;">Output: </span><span style="color:#ff80f4;">8
</span><span style="color:#f8f8f2;">second question took: </span><span style="color:#ff80f4;">5.723529959</span><span style="color:#f8f8f2;">s
</span><span style="color:#f8f8f2;">question </span><span style="color:#ff80f4;">3
</span><span style="color:#f8f8f2;">Step </span><span style="color:#ff80f4;">1</span><span style="color:#f8f8f2;">: </span><span style="color:#ff80f4;">7 </span><span style="color:#f92672;">+ </span><span style="color:#ff80f4;">5 </span><span style="color:#f92672;">= </span><span style="color:#ff80f4;">12
</span><span style="color:#f8f8f2;">Step </span><span style="color:#ff80f4;">2</span><span style="color:#f8f8f2;">: </span><span style="color:#ff80f4;">12 </span><span style="color:#f92672;">/ </span><span style="color:#ff80f4;">2 </span><span style="color:#f92672;">= </span><span style="color:#ff80f4;">6
</span><span style="color:#f8f8f2;">Output: </span><span style="color:#ff80f4;">6
</span><span style="color:#f8f8f2;">third question took: </span><span style="color:#ff80f4;">9.303650625</span><span style="color:#f8f8f2;">s</span></pre>
</div></div><p data-node-hydration="51">The third question required a more complex calculation and took more tokens to solve, but the time to solve the question was still significantly faster than the first question. The session from the first question was reused for the second and third questions which made the second and third questions run faster.</p><ul data-node-hydration="52"><li><strong>Evaluation Abstraction:</strong> Introducing an evaluation abstraction, providing enhanced functionality. (<a href="https://github.com/floneum/floneum/pull/113" rel="noopener noreferrer" data-node-hydration="53,click:1"><!--node-id54-->#113<!--#--></a>)</li></ul><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="55"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="56,click:1"><!--placeholder57--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="58"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="59"><pre style="background-color:#0d0d0d;">
<span style="color:#f92672;">+-----------------+-------+
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Statistic       </span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Value </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">+=========================+
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Mean            </span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.75  </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|-----------------+-------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Median          </span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.77  </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|-----------------+-------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Min             </span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.49  </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|-----------------+-------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Max             </span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.94  </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|-----------------+-------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> 25th Percentile </span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.67  </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|-----------------+-------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> 75th Percentile </span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.81  </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">+-----------------+-------+
</span><span style="color:#f92672;">+------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------+
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Expected Output                                                                          </span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Actual Output                                                                             </span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Score              </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">+===========================================================================================================================================================================================================+
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> What are Floneum plugins</span><span style="color:#f92672;">?                                                                |</span><span style="color:#f8f8f2;"> What is designed to support an expanding ecosystem of plugins</span><span style="color:#f92672;">?                            | </span><span style="color:#ff80f4;">0.49 </span><span style="color:#f8f8f2;">(low outlier) </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> What is supervised learning </span><span style="color:#f92672;">in</span><span style="color:#f8f8f2;"> machine learning</span><span style="color:#f92672;">?                                         |</span><span style="color:#f8f8f2;"> What is required </span><span style="color:#f92672;">for</span><span style="color:#f8f8f2;"> machine learning models </span><span style="color:#f92672;">in</span><span style="color:#f8f8f2;"> order to make accurate predictions</span><span style="color:#f92672;">?       | </span><span style="color:#ff80f4;">0.50 </span><span style="color:#f8f8f2;">(low outlier) </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> What distinguishes open</span><span style="color:#f92672;">-</span><span style="color:#f8f8f2;">source software from proprietary software</span><span style="color:#f92672;">?                       |</span><span style="color:#f8f8f2;"> What </span><span style="font-style:italic;color:#66d9ef;">type </span><span style="color:#f8f8f2;">of access does open source software provide </span><span style="color:#f92672;">for</span><span style="color:#f8f8f2;"> its users</span><span style="color:#f92672;">?                      | </span><span style="color:#ff80f4;">0.64               </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> How does blockchain contribute to the security of cryptocurrencies</span><span style="color:#f92672;">?                      |</span><span style="color:#f8f8f2;"> What is the advantage of cryptocurrency over traditional currencies </span><span style="color:#f92672;">in</span><span style="color:#f8f8f2;"> terms of security</span><span style="color:#f92672;">? | </span><span style="color:#ff80f4;">0.65               </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> What are the tradeoffs of using chat </span><span style="color:#ff80f4;">GPT</span><span style="color:#f92672;">?                                                |</span><span style="color:#f8f8f2;"> What is an example of how using ChatGPT may </span><span style="background-color:#f92672;color:#f8f8f0;">become</span><span style="color:#f8f8f2;"> challenging </span><span style="color:#f92672;">in</span><span style="color:#f8f8f2;"> certain situations</span><span style="color:#f92672;">?     | </span><span style="color:#ff80f4;">0.65               </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------|
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> What is the relationship between DevOps, continuous integration and continuous delivery</span><span style="color:#f92672;">? |</span><span style="color:#f8f8f2;"> What is the main goal of DevOps</span><span style="color:#f92672;">?                                                          | </span><span style="color:#ff80f4;">0.67               </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">|------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------|
</span><span style="color:#f92672;">| ... </span><span style="color:#ff80f4;">18</span><span style="color:#f8f8f2;"> more                                                                              </span><span style="color:#f92672;">|                                                                                           | </span><span style="color:#ff80f4;">0.80 </span><span style="color:#f8f8f2;">(average)     </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">+------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+--------------------+
</span><span style="color:#f92672;">|</span><span style="color:#f8f8f2;"> Score Histogram        </span><span style="color:#f92672;">|
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.00 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.10</span><span style="color:#f8f8f2;">:           |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.10 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.20</span><span style="color:#f8f8f2;">:           |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.20 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.30</span><span style="color:#f8f8f2;">:           |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.30 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.40</span><span style="color:#f8f8f2;">:           |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.40 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.50</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">*         |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.50 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.60</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">*         |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.60 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.70</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">******    |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.70 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.80</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">********* |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.80 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">0.90</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">*****     |
</span><span style="color:#f92672;">| </span><span style="color:#ff80f4;">0.90 </span><span style="color:#f92672;">- </span><span style="color:#ff80f4;">1.00</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">**        |</span></pre>
</div></div><ul data-node-hydration="60"><li><strong>Prompt Auto-Tuning:</strong> Prompts can now be automatically tuned for better performance. (<a href="https://github.com/floneum/floneum/pull/132" rel="noopener noreferrer" data-node-hydration="61,click:1"><!--node-id62-->#132<!--#--></a>)</li></ul><p data-node-hydration="63">Lets take a look at the new prompt auto-tuning feature with an example. As part of the <a href="/blog/kalosm_0_2#improved-chunking-strategies" data-node-hydration="64,click:1"><!--node-id65-->RAG improvements<!--#--></a>, kalosm includes a task that generates hypothetical questions about a text for an embedding model that can be used to find similar documents based on the meaning of the text for the  section. We can tune that task to find the best examples for the task with a <code>PromptAnnealer</code>:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="66"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="67,click:1"><!--placeholder68--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="69"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="70"><pre style="background-color:#0d0d0d;">
<span style="font-style:italic;color:#66d9ef;">const </span><span style="color:#ff80f4;">EXAMPLES</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">[(</span><span style="color:#f92672;">&amp;</span><span style="font-style:italic;color:#66d9ef;">str</span><span style="color:#f8f8f2;">, </span><span style="color:#f92672;">&amp;</span><span style="font-style:italic;color:#66d9ef;">str</span><span style="color:#f8f8f2;">)]</span><span style="color:#f92672;">= &amp;</span><span style="color:#f8f8f2;">[
</span><span style="color:#f8f8f2;">    (</span><span style="color:#ffee99;">&quot;An example input to the task&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;An example output to the task&quot;</span><span style="color:#f8f8f2;">),
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// ...more examples
</span><span style="color:#f8f8f2;">];
</span><span style="color:#f8f8f2;">
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> llm </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Phi::v2();
</span><span style="font-style:italic;color:#66d9ef;">const </span><span style="color:#ff80f4;">PREFIX</span><span style="color:#f8f8f2;">: </span><span style="color:#f92672;">&amp;</span><span style="font-style:italic;color:#66d9ef;">str </span><span style="color:#f92672;">= </span><span style="color:#ffee99;">&quot;Questions that are answered by the previous text: &quot;</span><span style="color:#f8f8f2;">;
</span><span style="font-style:italic;color:#66d9ef;">const </span><span style="color:#ff80f4;">QUESTION_STARTERS</span><span style="color:#f8f8f2;">: [</span><span style="color:#f92672;">&amp;</span><span style="font-style:italic;color:#66d9ef;">str</span><span style="color:#f8f8f2;">; </span><span style="color:#ff80f4;">9</span><span style="color:#f8f8f2;">] </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">[
</span><span style="color:#f8f8f2;">    </span><span style="color:#ffee99;">&quot;Who&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;What&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;When&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Where&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Why&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;How&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Which&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Whom&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Whose&quot;</span><span style="color:#f8f8f2;">,
</span><span style="color:#f8f8f2;">];
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> constraints </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">LiteralParser::new(</span><span style="color:#ff80f4;">PREFIX</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">then</span><span style="color:#f8f8f2;">(
</span><span style="color:#f8f8f2;">    IndexParser::new(
</span><span style="color:#f8f8f2;">        </span><span style="color:#ff80f4;">QUESTION_STARTERS
</span><span style="color:#f8f8f2;">            .</span><span style="color:#66d9ef;">iter</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">            .</span><span style="color:#66d9ef;">copied</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">            .</span><span style="color:#66d9ef;">map</span><span style="color:#f8f8f2;">(LiteralParser::new)
</span><span style="color:#f8f8f2;">            .collect::&lt;Vec&lt;</span><span style="color:#f92672;">_</span><span style="color:#f8f8f2;">&gt;&gt;(),
</span><span style="color:#f8f8f2;">    )
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">then</span><span style="color:#f8f8f2;">(StopOn::new(</span><span style="color:#ffee99;">&quot;?&quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">filter_characters</span><span style="color:#f8f8f2;">(
</span><span style="color:#f8f8f2;">        |</span><span style="font-style:italic;color:#fd971f;">c</span><span style="color:#f8f8f2;">| matches!(c, </span><span style="color:#ffee99;">&#39; &#39; </span><span style="color:#f92672;">| </span><span style="color:#ffee99;">&#39;?&#39; </span><span style="color:#f92672;">| </span><span style="color:#ffee99;">&#39;a&#39;</span><span style="color:#f92672;">..=</span><span style="color:#ffee99;">&#39;z&#39; </span><span style="color:#f92672;">| </span><span style="color:#ffee99;">&#39;A&#39;</span><span style="color:#f92672;">..=</span><span style="color:#ffee99;">&#39;Z&#39; </span><span style="color:#f92672;">| </span><span style="color:#ffee99;">&#39;0&#39;</span><span style="color:#f92672;">..=</span><span style="color:#ffee99;">&#39;9&#39; </span><span style="color:#f92672;">| </span><span style="color:#ffee99;">&#39;,&#39;</span><span style="color:#f8f8f2;">),
</span><span style="color:#f8f8f2;">    ))
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">repeat</span><span style="color:#f8f8f2;">(</span><span style="color:#ff80f4;">1</span><span style="color:#f92672;">..=</span><span style="color:#ff80f4;">5</span><span style="color:#f8f8f2;">),
</span><span style="color:#f8f8f2;">);
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> task </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Task::builder(</span><span style="color:#ffee99;">&quot;You generate hypothetical questions that may be answered by the given text. The questions restate any information necessary to understand the question&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">with_constraints</span><span style="color:#f8f8f2;">(constraints);
</span><span style="font-style:italic;color:#66d9ef;">let </span><span style="color:#f92672;">mut</span><span style="color:#f8f8f2;"> annealing </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">kalosm::PromptAnnealer::builder(</span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">llm, </span><span style="color:#ff80f4;">EXAMPLES</span><span style="color:#f8f8f2;">, task)
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">with_initial_temperature</span><span style="color:#f8f8f2;">(</span><span style="color:#ff80f4;">0.6</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">with_initial_choice_range</span><span style="color:#f8f8f2;">(</span><span style="color:#ff80f4;">1</span><span style="color:#f92672;">..</span><span style="color:#ff80f4;">4</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">build</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">    .await;
</span><span style="color:#f8f8f2;">
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> result </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> annealing.</span><span style="color:#66d9ef;">run</span><span style="color:#f8f8f2;">().await;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">println!(</span><span style="color:#ffee99;">&quot;Result: </span><span style="color:#ff80f4;">{:?}</span><span style="color:#ffee99;">&quot;</span><span style="color:#f8f8f2;">, result);</span></pre>
</div></div><p data-node-hydration="71">Here is the best set of examples that the prompt annealer found for the task:</p><table data-node-hydration="72"><thead><th>Input</th><th>Output</th></thead><tr><th>While traditional databases rely on a fixed schema, NoSQL databases like MongoDB offer a flexible structure, allowing you to store and retrieve data in a more dynamic way. This flexibility is particularly beneficial for applications with evolving data requirements.</th><th>&quot;How does MongoDB differ from traditional databases?</th></tr><tr><th>Blockchain technology, beyond cryptocurrencies, is being explored for applications like smart contracts. Smart contracts are self-executing contracts with the terms of the agreement directly written into code.</th><th>&quot;How is blockchain technology utilized in the concept of smart contracts?</th></tr></table><p data-node-hydration="73">Feeding those two examples into the task achieves a similarity score of 0.71 for all of the other examples compared to choosing two random examples from the task which only achieves a similarity score of  0.62 for all of the other examples.</p><h2 id="regex-validation" data-node-hydration="74"><a href="/blog/kalosm_0_2#regex-validation" class="header" data-node-hydration="75,click:1"><!--node-id76-->Regex Validation<!--#--></a></h2><p data-node-hydration="77">Some feedback we got from the initial release of kalosm, was that constraints for constrained generation was too complex. Constraints in Kalosm serve two purposes:</p><ol data-node-hydration="78"><li>Validation: Constraints can be used to validate the output of the model. The model will only output text that can be parsed by the constraints. This lets you ensure that the output of the model is in the format you expect.</li></ol><p data-node-hydration="79">For example, you may want to force the model response to always start with a prefix that guides the model:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="80"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="81,click:1"><!--placeholder82--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="83"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="84"><pre style="background-color:#0d0d0d;">
<span style="color:#f92672;">use </span><span style="color:#f8f8f2;">kalosm::language::</span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">#[tokio::main]
</span><span style="color:#f8f8f2;">async </span><span style="font-style:italic;color:#66d9ef;">fn </span><span style="color:#a6e22e;">main</span><span style="color:#f8f8f2;">() {
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> llm </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Llama::default();
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> prompt </span><span style="color:#f92672;">= </span><span style="color:#ffee99;">&quot;Generate a list of 10 words you use to describe yourself: &quot;</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> validator </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">LiteralParser::new(</span><span style="color:#ffee99;">&quot;(Responding as a pirate) &quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">then</span><span style="color:#f8f8f2;">(OneLine);
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> stream </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> llm.</span><span style="color:#66d9ef;">stream_structured_text</span><span style="color:#f8f8f2;">(prompt, validator).await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    stream.</span><span style="color:#66d9ef;">to_std_out</span><span style="color:#f8f8f2;">().await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">}</span></pre>
</div></div><ol data-node-hydration="85"><li>Parsing: Constraints can be used to parse the output of the model. This can be extremely useful when you want to generate a specific structure from an LLM without writing separate logic for validation and parsing.</li></ol><p data-node-hydration="86">For example, you may want to generate a list of 10 numbers:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="87"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="88,click:1"><!--placeholder89--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="90"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="91"><pre style="background-color:#0d0d0d;">
<span style="color:#f92672;">use </span><span style="color:#f8f8f2;">kalosm::language::</span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">#[tokio::main]
</span><span style="color:#f8f8f2;">async </span><span style="font-style:italic;color:#66d9ef;">fn </span><span style="color:#a6e22e;">main</span><span style="color:#f8f8f2;">() {
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> llm </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Llama::default();
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> prompt </span><span style="color:#f92672;">= </span><span style="color:#ffee99;">&quot;Prime numbers: &quot;</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> validator </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">&lt;[</span><span style="font-style:italic;color:#66d9ef;">f32</span><span style="color:#f8f8f2;">; </span><span style="color:#ff80f4;">10</span><span style="color:#f8f8f2;">] as HasParser&gt;::new_parser();
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> words </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> llm.</span><span style="color:#66d9ef;">stream_structured_text</span><span style="color:#f8f8f2;">(prompt, validator).await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> result: [</span><span style="font-style:italic;color:#66d9ef;">f32</span><span style="color:#f8f8f2;">; </span><span style="color:#ff80f4;">10</span><span style="color:#f8f8f2;">] </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> words.</span><span style="color:#66d9ef;">result</span><span style="color:#f8f8f2;">().await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">    println!(</span><span style="color:#ffee99;">&quot;Prime numbers: </span><span style="color:#ff80f4;">{:?}</span><span style="color:#ffee99;">&quot;</span><span style="color:#f8f8f2;">, result);
</span><span style="color:#f8f8f2;">}</span></pre>
</div></div><p data-node-hydration="92">If you only need to validate the output of the model, the existing constraints can be more complex than what you need. In this release, we&#x27;ve added support for regex validation. This makes it easier to validate the output of the model without handling parsing:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="93"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="94,click:1"><!--placeholder95--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="96"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="97"><pre style="background-color:#0d0d0d;">
<span style="color:#f92672;">use </span><span style="color:#f8f8f2;">kalosm::language::</span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">#[tokio::main]
</span><span style="color:#f8f8f2;">async </span><span style="font-style:italic;color:#66d9ef;">fn </span><span style="color:#a6e22e;">main</span><span style="color:#f8f8f2;">() {
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> llm </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Llama::default();
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> prompt </span><span style="color:#f92672;">= </span><span style="color:#ffee99;">&quot;Generate a list of 10 words you use to describe yourself: &quot;</span><span style="color:#f8f8f2;">;
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> validator </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">RegexParser::new(</span><span style="font-style:italic;color:#66d9ef;">r</span><span style="color:#ffee99;">&quot;\(Responding as a pirate\) ([a-z]{1,10}, ){10}&quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> stream </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> llm.</span><span style="color:#66d9ef;">stream_structured_text</span><span style="color:#f8f8f2;">(prompt, validator).await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    stream.</span><span style="color:#66d9ef;">to_std_out</span><span style="color:#f8f8f2;">().await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">}</span></pre>
</div></div><h2 id="surreal-database-integration" data-node-hydration="98"><a href="/blog/kalosm_0_2#surreal-database-integration" class="header" data-node-hydration="99,click:1"><!--node-id100-->Surreal Database Integration<!--#--></a></h2><p data-node-hydration="101">Vector databases can be very useful when combined with LLMs. They can be used to store and retrieve similar documents based on the meaning of the text, not just the words used. However, vector databases only handle a very limited number of use cases. In this release, we&#x27;ve added support for Surreal DB for more traditional database use cases. Surreal DB can be embedded into your application and used to store and retrieve data locally as well as over the network.</p><p data-node-hydration="102">Kalosm 0.2 allows you to create tables within Surreal DB that are indexed by vectors. You can then insert documents (or other embeddings) into the table and query the table for similar documents based on the meaning of the text.</p><p data-node-hydration="103">Let&#x27;s take a look at how you can use the Surreal DB integration to store and retrieve similar documents based on the meaning of the text:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="104"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="105,click:1"><!--placeholder106--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="107"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="108"><pre style="background-color:#0d0d0d;">
<span style="color:#f92672;">use </span><span style="color:#f8f8f2;">comfy_table::{Cell, Color, Row, Table};
</span><span style="color:#f92672;">use </span><span style="color:#f8f8f2;">kalosm::language::</span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">;
</span><span style="color:#f92672;">use </span><span style="color:#f8f8f2;">kalosm::</span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">;
</span><span style="color:#f92672;">use </span><span style="color:#f8f8f2;">std::path::PathBuf;
</span><span style="color:#f92672;">use </span><span style="color:#f8f8f2;">surrealdb::{engine::local::RocksDb, Surreal};
</span><span style="color:#f8f8f2;">
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> exists </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">std::path::Path::new(</span><span style="color:#ffee99;">&quot;./db&quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">exists</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// Create or open a new database at ./db/temp.db
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> db </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Surreal::new::&lt;RocksDb&gt;(</span><span style="color:#ffee99;">&quot;./db/temp.db&quot;</span><span style="color:#f8f8f2;">).await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// Select a specific namespace / database within the database
</span><span style="color:#f8f8f2;">db.</span><span style="color:#66d9ef;">use_ns</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;test&quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">use_db</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;test&quot;</span><span style="color:#f8f8f2;">).await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// Create a new document table that uses arroy for fast vector search
</span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> document_table </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> db
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">document_table_builder</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;documents&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Store the embedding database in the same directory as the document table
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">at</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;./db/embeddings.db&quot;</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">build</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">    .</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// If the database doesn&#39;t exist, create it and insert some documents
</span><span style="color:#f92672;">if !</span><span style="color:#f8f8f2;">exists {
</span><span style="color:#f8f8f2;">    std::fs::create_dir_all(</span><span style="color:#ffee99;">&quot;documents&quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Load some files from a directory
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> documents </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">DocumentFolder::try_from(PathBuf::from(</span><span style="color:#ffee99;">&quot;./documents&quot;</span><span style="color:#f8f8f2;">)).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Convert the folder into a vector of documents
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> documents </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> documents.</span><span style="color:#66d9ef;">into_documents</span><span style="color:#f8f8f2;">().await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">    </span><span style="color:#f92672;">for</span><span style="color:#f8f8f2;"> document </span><span style="color:#f92672;">in</span><span style="color:#f8f8f2;"> documents {
</span><span style="color:#f8f8f2;">        </span><span style="color:#8c8c8c;">// And insert the documents into the table (this will automatically chunk and embed the documents before they are inserted into the table and vector database)
</span><span style="color:#f8f8f2;">        document_table.</span><span style="color:#66d9ef;">insert</span><span style="color:#f8f8f2;">(document).await.</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">    }
</span><span style="color:#f8f8f2;">}
</span><span style="color:#f8f8f2;">
</span><span style="color:#8c8c8c;">// Now we can query the table for similar documents based on the meaning of the text
</span><span style="color:#f92672;">loop </span><span style="color:#f8f8f2;">{
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Get a query from the user and embed that query into a vector
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> user_question </span><span style="color:#f92672;">= </span><span style="color:#66d9ef;">prompt_input</span><span style="color:#f8f8f2;">(</span><span style="color:#ffee99;">&quot;Query: &quot;</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> user_question_embedding </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> document_table
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">embedding_model_mut</span><span style="color:#f8f8f2;">()
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">embed</span><span style="color:#f8f8f2;">(</span><span style="color:#f92672;">&amp;</span><span style="color:#f8f8f2;">user_question)
</span><span style="color:#f8f8f2;">        .await
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Select the 5 most similar documents to the user&#39;s query
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> nearest_5 </span><span style="color:#f92672;">=</span><span style="color:#f8f8f2;"> document_table
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">select_nearest_embedding</span><span style="color:#f8f8f2;">(user_question_embedding, </span><span style="color:#ff80f4;">5</span><span style="color:#f8f8f2;">)
</span><span style="color:#f8f8f2;">        .await
</span><span style="color:#f8f8f2;">        .</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="color:#8c8c8c;">// Display the results in a formatted table with colors based on the distance from the query
</span><span style="color:#f8f8f2;">    </span><span style="font-style:italic;color:#66d9ef;">let </span><span style="color:#f92672;">mut</span><span style="color:#f8f8f2;"> table </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Table::new();
</span><span style="color:#f8f8f2;">    table.</span><span style="color:#66d9ef;">set_header</span><span style="color:#f8f8f2;">(vec![</span><span style="color:#ffee99;">&quot;Score&quot;</span><span style="color:#f8f8f2;">, </span><span style="color:#ffee99;">&quot;Value&quot;</span><span style="color:#f8f8f2;">]);
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    </span><span style="color:#f92672;">for</span><span style="color:#f8f8f2;"> result </span><span style="color:#f92672;">in</span><span style="color:#f8f8f2;"> nearest_5 {
</span><span style="color:#f8f8f2;">        </span><span style="font-style:italic;color:#66d9ef;">let </span><span style="color:#f92672;">mut</span><span style="color:#f8f8f2;"> row </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">Row::new();
</span><span style="color:#f8f8f2;">        </span><span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> color </span><span style="color:#f92672;">= if</span><span style="color:#f8f8f2;"> result.distance </span><span style="color:#f92672;">&lt; </span><span style="color:#ff80f4;">0.25 </span><span style="color:#f8f8f2;">{
</span><span style="color:#f8f8f2;">            Color::Green
</span><span style="color:#f8f8f2;">        } </span><span style="color:#f92672;">else if</span><span style="color:#f8f8f2;"> result.distance </span><span style="color:#f92672;">&lt; </span><span style="color:#ff80f4;">0.75 </span><span style="color:#f8f8f2;">{
</span><span style="color:#f8f8f2;">            Color::Yellow
</span><span style="color:#f8f8f2;">        } </span><span style="color:#f92672;">else </span><span style="color:#f8f8f2;">{
</span><span style="color:#f8f8f2;">            Color::Red
</span><span style="color:#f8f8f2;">        };
</span><span style="color:#f8f8f2;">        row.</span><span style="color:#66d9ef;">add_cell</span><span style="color:#f8f8f2;">(Cell::new(result.distance).</span><span style="color:#66d9ef;">fg</span><span style="color:#f8f8f2;">(color))
</span><span style="color:#f8f8f2;">            .</span><span style="color:#66d9ef;">add_cell</span><span style="color:#f8f8f2;">(Cell::new(result.record.</span><span style="color:#66d9ef;">body</span><span style="color:#f8f8f2;">()[</span><span style="color:#ff80f4;">0</span><span style="color:#f92672;">..</span><span style="color:#ff80f4;">50</span><span style="color:#f8f8f2;">].</span><span style="color:#66d9ef;">to_string</span><span style="color:#f8f8f2;">() </span><span style="color:#f92672;">+ </span><span style="color:#ffee99;">&quot;...&quot;</span><span style="color:#f8f8f2;">));
</span><span style="color:#f8f8f2;">        table.</span><span style="color:#66d9ef;">add_row</span><span style="color:#f8f8f2;">(row);
</span><span style="color:#f8f8f2;">    }
</span><span style="color:#f8f8f2;">
</span><span style="color:#f8f8f2;">    println!(</span><span style="color:#ffee99;">&quot;</span><span style="color:#ff80f4;">{}</span><span style="color:#ffee99;">&quot;</span><span style="color:#f8f8f2;">, table);
</span><span style="color:#f8f8f2;">}</span></pre>
</div></div><h2 id="rag-improvements" data-node-hydration="109"><a href="/blog/kalosm_0_2#rag-improvements" class="header" data-node-hydration="110,click:1"><!--node-id111-->RAG improvements<!--#--></a></h2><p data-node-hydration="112">RAG (Retrieval-Augmented Generation) is a powerful tool for generating text with up-to-date or proprietary information. Retrieval-augmented generation generally follows the following steps:</p><ol data-node-hydration="113"><li>Gather context from some local files, your database, or web data. In kalosm, you can retrieve data from any source that implements <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/trait.IntoDocument.html" rel="noopener noreferrer" data-node-hydration="114,click:1"><code data-node-hydration="115">IntoDocument</code></a> or <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/trait.IntoDocuments.html" rel="noopener noreferrer" data-node-hydration="116,click:1"><code data-node-hydration="117">IntoDocuments</code></a>. You can gather your sources from <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/struct.DocumentFolder.html" rel="noopener noreferrer" data-node-hydration="118,click:1"><!--node-id119-->local documents<!--#--></a>, a <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/struct.SearchQuery.html" rel="noopener noreferrer" data-node-hydration="120,click:1"><!--node-id121-->search term<!--#--></a>, <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/struct.Url.html" rel="noopener noreferrer" data-node-hydration="122,click:1"><!--node-id123-->specific web page<!--#--></a>, an <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/struct.RssFeed.html" rel="noopener noreferrer" data-node-hydration="124,click:1"><!--node-id125-->RSS feed<!--#--></a>, or even a <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/enum.Page.html#method.crawl" rel="noopener noreferrer" data-node-hydration="126,click:1"><!--node-id127-->custom web crawler<!--#--></a>.</li><li>Insert that context into a searchable database. Kalosm includes a <a href="https://docs.rs/kalosm/0.2.0/kalosm/language/struct.VectorDB.html" rel="noopener noreferrer" data-node-hydration="128,click:1"><!--node-id129-->vector database<!--#--></a> that can be used to store and retrieve similar documents.</li></ol><p data-node-hydration="130">Vector databases use an embedding model which generates a vector for a chunk of text (typically smaller than the entire document). The vector is then stored in the database. When you want to retrieve similar documents, you can embed a query and search for similar vectors in the database.</p><p data-node-hydration="131">The vectors represent the meaning of the text, so you can search for similar documents based on the meaning of the text, not just the words used.</p><ol data-node-hydration="132"><li>Use the context to generate text. You can find text similar to the question or a search generated by the LLM and then generate a response based on the context.</li></ol><p data-node-hydration="133">In this release, we&#x27;ve made several improvements to RAG! (<a href="https://github.com/floneum/floneum/pull/126" rel="noopener noreferrer" data-node-hydration="134,click:1"><!--node-id135-->#126<!--#--></a>)</p><h3 id="improved-chunking-strategies" data-node-hydration="136"><a href="/blog/kalosm_0_2#improved-chunking-strategies" class="header" data-node-hydration="137,click:1"><!--node-id138-->Improved Chunking Strategies<!--#--></a></h3><p data-node-hydration="139">When you insert a document into a vector database, it needs to be split into smaller chunks before the text is embedded. The chunks you choose can have a significant impact on the performance of the results you get from the vector database. In this release, we&#x27;ve added two new chunking strategies to the vector database:</p><ul data-node-hydration="140"><li>Hypothetical Questions</li></ul><p data-node-hydration="141">Instead of generating embeddings based on the content of the document, this chunking strategy generates embeddings based on hypothetical questions generated about the document. This can be extremely useful when building a chatbot that needs to find context that is relevant to a question.</p><p data-node-hydration="142">For example, if you have a document about the history of the United States, you can generate hypothetical questions like &quot;What is the capital of the United States?&quot; and &quot;Who was the first president of the United States?&quot; and then generate embeddings based on those questions.</p><p data-node-hydration="143">Then if you query the vector database with a question like &quot;Who was the leader of the US?&quot; you can find the document about the history of the United States.</p><blockquote data-node-hydration="144"><p>Notice that the question &quot;Who was the leader of the US?&quot; doesn&#x27;t contain many of the same words as the hypothetical questions, but it does convey a similar meaning, so the vector database can still find the relevant document.</p></blockquote><ul data-node-hydration="145"><li>Summaries</li></ul><p data-node-hydration="146">This chunking strategy generates embeddings based on the summary of the document. This can be useful when you have a large document and you want to find similar documents based on the main points of the document.</p><p data-node-hydration="147">Generating embeddings based on the summary of the document can create better embeddings that contain more information about the document than embeddings that only contain one small chunk of the document.</p><h3 id="incremental-indexing" data-node-hydration="148"><a href="/blog/kalosm_0_2#incremental-indexing" class="header" data-node-hydration="149,click:1"><!--node-id150-->Incremental Indexing<!--#--></a></h3><p data-node-hydration="151">In addition to the new chunking strategies, we&#x27;ve also added support for incremental indexing. This means you can add new documents to the vector database without having to recreate the entire database. This can be extremely useful when you have a large database or you have constantly updating context you want to provide to your LLM.</p><p data-node-hydration="152">Kalosm&#x27;s Vector database is now backed by <a href="https://github.com/meilisearch/arroy" rel="noopener noreferrer" data-node-hydration="153,click:1"><!--node-id154-->arroy<!--#--></a>, a space-efficient and incrementally indexed vector database backed by MeiliSearch!</p><h2 id="performance-improvements" data-node-hydration="155"><a href="/blog/kalosm_0_2#performance-improvements" class="header" data-node-hydration="156,click:1"><!--node-id157-->Performance Improvements<!--#--></a></h2><p data-node-hydration="158">The llama implementation has been rewritten and optimized for better performance and modularity. The new implementation is now 7-25% faster than the previous version. In future releases, we plan to add support for fine tuning models and training new heads for existing models. (<a href="https://github.com/floneum/floneum/pull/122" rel="noopener noreferrer" data-node-hydration="159,click:1"><!--node-id160-->#122<!--#--></a>)</p><p data-node-hydration="161">Language models like Llama and Phi output probabilities for each token in the vocabulary. To generate text you need to sample from the probability distribution. Sampling from the probability distribution can be slow, especially with large vocabularies. Kalosm 0.2 uses an optimization introduced in <a href="https://github.com/KerfuffleV2/llm-samplers/pull/9" rel="noopener noreferrer" data-node-hydration="162,click:1"><!--node-id163-->llm-samplers<!--#--></a> to only sample top 512 tokens. This optimization can make sampling up to 2x faster. (<a href="https://github.com/floneum/floneum/pull/123" rel="noopener noreferrer" data-node-hydration="164,click:1"><!--node-id165-->#123<!--#--></a>)</p><p data-node-hydration="166">Large sections of text that are static within a constraint in structured generation is now loaded in a batch which can significantly speed up the process.</p><p data-node-hydration="167">For example if you have the constraints:</p><div class="border overflow-hidden rounded-md border-gray-300 dark:border-gray-700 mb-8" style="position:relative;" data-node-hydration="168"><button class="flex flex-row items-center gap-1 hover:text-blue-600" onclick="navigator.clipboard.writeText(this.parentNode.parentNode.lastChild.innerText);" style="position:absolute;top:0;right:0;" data-node-hydration="169,click:1"><!--placeholder170--><span><svg width="24" height="24" stroke-width="1.5" fill="none" stroke="currentColor" data-node-hydration="171"><path d="M8 16c0 1.886 0 2.828.586 3.414C9.172 20 10.114 20 12 20h4c1.886 0 2.828 0 3.414-.586C20 18.828 20 17.886 20 16v-4c0-1.886 0-2.828-.586-3.414C18.828 8 17.886 8 16 8m-8 8h4c1.886 0 2.828 0 3.414-.586C16 14.828 16 13.886 16 12V8m-8 8c-1.886 0-2.828 0-3.414-.586C4 14.828 4 13.886 4 12V8c0-1.886 0-2.828.586-3.414C5.172 4 6.114 4 8 4h4c1.886 0 2.828 0 3.414.586C16 5.172 16 6.114 16 8"></path></svg></span></button><div class="overflow-x-scroll bg-[#0d0d0d]" data-node-hydration="172"><pre style="background-color:#0d0d0d;">
<span style="font-style:italic;color:#66d9ef;">let</span><span style="color:#f8f8f2;"> constraints </span><span style="color:#f92672;">= </span><span style="color:#f8f8f2;">RegexParser::new(</span><span style="font-style:italic;color:#66d9ef;">r</span><span style="color:#ffee99;">#&quot;(The title of the book is [a-z]{2,15}\n)*&quot;#</span><span style="color:#f8f8f2;">).</span><span style="color:#66d9ef;">unwrap</span><span style="color:#f8f8f2;">();</span></pre>
</div></div><p data-node-hydration="173">The text &quot;The title of the book is &quot; will be loaded in a batch instead of one token at a time. Batched loading has been restored in constrained generation. (<a href="https://github.com/floneum/floneum/pull/131" rel="noopener noreferrer" data-node-hydration="174,click:1"><!--node-id175-->#131<!--#--></a>)</p><h2 id="new-models" data-node-hydration="176"><a href="/blog/kalosm_0_2#new-models" class="header" data-node-hydration="177,click:1"><!--node-id178-->New Models<!--#--></a></h2><p data-node-hydration="179">Kalosm 0.2 adds support for several new models, including:</p><ul data-node-hydration="180"><li><strong>Dolphin Phi v2</strong> A tiny chat model</li><li><strong>Solar-11b Models</strong> A set of models for chat, text, and code generation</li><li><strong>Tiny Llama 1.0</strong> A tiny set of models for chat, and text text generation</li></ul><h2 id="full-changelog" data-node-hydration="181"><a href="/blog/kalosm_0_2#full-changelog" class="header" data-node-hydration="182,click:1"><!--node-id183-->Full Changelog<!--#--></a></h2><p data-node-hydration="184">For a detailed list of changes between v0.1.0 and v0.2.0, please see the <a href="https://github.com/floneum/floneum/compare/v0.2.0...v0.2.0-kalosm" rel="noopener noreferrer" data-node-hydration="185,click:1"><!--node-id186-->full changelog<!--#--></a>.</p><p data-node-hydration="187">I hope you enjoy using Kalosm v0.2.0! Your feedback is invaluable to us, so please don&#x27;t hesitate to share your thoughts and report any issues you encounter.</p><h2 id="whats-next" data-node-hydration="188"><a href="/blog/kalosm_0_2#whats-next" class="header" data-node-hydration="189,click:1"><!--node-id190-->What&#x27;s next?<!--#--></a></h2><p data-node-hydration="191">In the next release, we plan to add support for fine tuning models and training new heads for existing models. We also plan to continue improving the performance of the language models and adding support for more models.</p><p data-node-hydration="192">If any of those features sound interesting or you want to propose a new feature, consider contributing on <a href="https://github.com/floneum/floneum/tree/main/interfaces/kalosm" rel="noopener noreferrer" data-node-hydration="193,click:1"><!--node-id194-->Github<!--#--></a>.</p><p data-node-hydration="195">If you are interested in building an application with Kalosm, <a href="https://discord.gg/dQdmhuB8q5" rel="noopener noreferrer" data-node-hydration="196,click:1"><!--node-id197-->join the Discord<!--#--></a> and get involved with the community!</p></article></div></div></section><div class="hidden xl:sticky xl:top-[4.75rem] xl:-mr-6 xl:block xl:h-[calc(100vh-4.75rem)] xl:flex-none xl:overflow-y-auto xl:py-16 xl:pr-6" data-node-hydration="198"><nav aria-labelledby="on-this-page-title" class="w-56"><h2 id="on-this-page-title" class="font-display text-sm font-medium text-slate-900" data-node-hydration="199">On this page</h2><ol role="list" class="mt-4 space-y-3 text-sm" data-node-hydration="200"><li class="pb-2 pl-2" data-node-hydration="201"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#kalosm-v0.2.0-tasks,-evaluation,-prompt-auto-tuning,-regex-validation,-surreal-database-integration,-rag-improvements,-performance-improvements,-and-more!" data-node-hydration="202"><!--node-id203-->Kalosm v0.2.0 Tasks, Evaluation, Prompt Auto-Tuning, Regex Validation, Surreal Database Integration, RAG improvements, Performance Improvements, and More!<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="204"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#tasks-and-agents!" data-node-hydration="205"><!--node-id206-->Tasks and Agents!<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="207"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#regex-validation" data-node-hydration="208"><!--node-id209-->Regex Validation<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="210"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#surreal-database-integration" data-node-hydration="211"><!--node-id212-->Surreal Database Integration<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="213"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#rag-improvements" data-node-hydration="214"><!--node-id215-->RAG improvements<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="216"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#performance-improvements" data-node-hydration="217"><!--node-id218-->Performance Improvements<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="219"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#new-models" data-node-hydration="220"><!--node-id221-->New Models<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="222"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#full-changelog" data-node-hydration="223"><!--node-id224-->Full Changelog<!--#--></a></h3></li><li class="pb-2 pl-4" data-node-hydration="225"><h3><a class="font-normal text-slate-500 hover:text-slate-700" href="#what's-next?" data-node-hydration="226"><!--node-id227-->What&#x27;s next?<!--#--></a></h3></li></ol></nav></div></div></div><footer class="bg-white" data-node-hydration="228"><div class="mx-auto max-w-7xl overflow-hidden px-6 py-20 sm:py-24 lg:px-8"><nav aria-label="Footer" class="-mb-6 columns-2 sm:flex sm:justify-center sm:space-x-12"><div class="pb-6" data-node-hydration="229"><a href="/" class="text-sm leading-6 text-gray-600 hover:text-gray-900" data-node-hydration="230,click:1"><!--node-id231-->About<!--#--></a></div><div class="pb-6" data-node-hydration="232"><a href="/docs/#" class="text-sm leading-6 text-gray-600 hover:text-gray-900" data-node-hydration="233,click:1"><!--node-id234-->Docs<!--#--></a></div><div class="pb-6" data-node-hydration="235"><a href="/blog/#" class="text-sm leading-6 text-gray-600 hover:text-gray-900" data-node-hydration="236,click:1"><!--node-id237-->Blog<!--#--></a></div></nav><div class="mt-10 flex justify-center space-x-10"><a href="https://github.com/floneum/floneum/tree/main/floneum/floneum" class="text-gray-400 hover:text-gray-500" rel="noopener noreferrer" data-node-hydration="238,click:1"><span class="sr-only" data-node-hydration="239">Github</span><svg class="h-6 w-6" viewBox="0 0 24 24" aria-hidden="true" data-node-hydration="240"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" fill="currentColor" fill-rule="nonzero"></path></svg></a><a href="https://discord.gg/dQdmhuB8q5" class="text-gray-400 hover:text-gray-500" rel="noopener noreferrer" data-node-hydration="241,click:1"><span class="sr-only" data-node-hydration="242">Discord</span><svg class="h-6 w-6" viewBox="0 -28.5 256 256" preserveAspectRatio="xMidYMid" aria-hidden="true" data-node-hydration="243"><path d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z" fill="currentColor" fill-rule="nonzero"></path></svg></a></div></div></footer><script>window.initial_dioxus_hydration_data="hIEY9oEY9YEY9YEY9Q==";</script>
  </div>
  <script>
    window.addEventListener('scroll', () => {
      let scrollTop = window.scrollY;
      let winHeight = window.document.documentElement.scrollHeight - window.document.documentElement.clientHeight;
      let new_scroll = Math.min(Math.max(scrollTop, 0) / Math.max(winHeight, 1), 1);

      document.body.style.setProperty('--scroll', new_scroll);
    }, false);
  </script>
<script>
            // We can't use a module script here because we need to start the script immediately when streaming
            import("/./assets/floneum-site-fa30d29a333f8ebd.js").then(
                ({ default: init }) => {
                init("/./assets/floneum-site_bg-345df61ed7f53097.wasm").then((wasm) => {
                    if (wasm.__wbindgen_start == undefined) {
                    wasm.main();
                    }
                });
                }
            );
            </script>
            
            </body>

</html>